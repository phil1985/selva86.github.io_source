<blockquote>
<p>Building a linear regression model is only half of the work. In order to actually be usable in practice, the model should conform to the assumptions of linear regression.</p>
</blockquote>
<h2>Assumption 1</h2>
<blockquote>
<h4><em>The regression model is linear in parameters</em></h4>
</blockquote>
<p>An example of model equation that is <em>linear in parameters</em> <br /><span class="math display"><em>Y</em> = <em>a</em> + (<em>β</em>1 * <em>X</em>1) + (<em>β</em>2 * <em>X</em>2<sup>2</sup>)</span><br /></p>
<p>Though, the <code>X2</code> is raised to power 2, the equation is still linear in beta parameters. So the assumption is satisfied in this case.</p>
<p>An example of <em>linear in variables</em> but <em>non-linear in parameters</em>. This will violate the assumption. <br /><span class="math display"><em>Y</em> = <em>a</em> + (<em>β</em>1 * <em>X</em>1) + (<em>β</em>2<sup>2</sup> * <em>X</em>2)</span><br /></p>
<p>Here, the beta parameter is raised to power 2, which is not linear. So the assumption is violated by this equation.</p>
<h2>Assumption 2</h2>
<blockquote>
<h4><em>The mean of errors is zero</em></h4>
</blockquote>
<h4>How to check?</h4>
<p>Check the mean of the residuals. If it approximately zero, then this assumption is held true for that model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars)
<span class="kw">mean</span>(mod$residuals)
<span class="co">#=&gt; 2.442491e-17</span></code></pre></div>
<p>Since the mean of residuals is approximately zero, this assumption holds true for this model.</p>
<h2>Assumption 3</h2>
<blockquote>
<h4><em>Homoscedasticity of errors or equal variance</em></h4>
</blockquote>
<h4>How to check?</h4>
<p>Once the regression model is built, set <code>par(mfrow=c(2, 2))</code>, then, plot the model using <code>plot(lm.mod)</code>. This produces four plots. The <em>top-left</em> and <em>bottom-left</em> plots shows how the <em>errors</em> vary as the <em>fitted</em> values increase.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))  <span class="co"># set 2 rows and 2 column plot layout</span>
mod_1 &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>disp, <span class="dt">data=</span>mtcars)  <span class="co"># linear model</span>
<span class="kw">plot</span>(mod_1)</code></pre></div>
<p><img src='screenshots/regression-plot-mtcars.png' width=528 height=528 /></p>
<p>From the first plot (topleft), as the fitted values along x increase, the residuals decrease and then increase. This pattern is indicated by the red line, which should be approximately flat if the errors are homoscedastic. The plot on the bottom left also checks this, and is more convenient as the error term in Y axis is standardised.</p>
<p>In this case, there is a definite pattern noticed. So, there is heterscedasticity. Lets check this on a different model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars[<span class="dv">1</span>:<span class="dv">20</span>, ])  <span class="co">#  linear model</span>
<span class="kw">plot</span>(mod)</code></pre></div>
<p><img src='screenshots/regression-plot-cars-20rows.png' width=528 height=528 /></p>
<p>Now, the points appear random and the line looks pretty flat, with no increasing or decreasing trend. So, the condition of homoscedasticity can be accepted.</p>
<h2>Assumption 4</h2>
<blockquote>
<h4><em>No autocorrelation of errors</em></h4>
<p>This is applicable especially for time series data. Autocorrelation is the correlation of a time Series with lags of itself. When the error is autocorrelated, it means that the current value is dependent of the previous (historic) values and that there is a definite unexplained pattern in the Y variable that shows up in the error term.</p>
</blockquote>
<h4>How to check for autocorrelation?</h4>
<p>Below, are 3 ways you could check for autocorrelation of errors.</p>
<h5>Using acf plot</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Method 1: Visualise with acf plot</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">data</span>(economics)
lmMod &lt;-<span class="st"> </span><span class="kw">lm</span>(pce ~<span class="st"> </span>pop, <span class="dt">data=</span>economics)
<span class="kw">acf</span>(lmMod$residuals)  <span class="co"># highly autocorrelated from the picture.</span></code></pre></div>
<p><img src='screenshots/acf-plot.png' width=528 height=305 /></p>
<p>The X axis correponds to the lags of the residual, increasing in steps of 1. The very first line (to the left) shows the correlation of residual with itself (Lag0), therefore, it will always be equal to 1.</p>
<p>If the errors were not autocorrelated, the correlation (Y-axis) from the immediate next line onwards will drop to a near zero value below the dashed blue line (significance level). Clearly, this is not the case here. So we can conclude that the residuals are autocorrelated.</p>
<h5>Using runs test</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Method 2: Runs test to test for randomness</span>
lawstat::<span class="kw">runs.test</span>(lmMod$residuals)
<span class="co">#=&gt;   Runs Test - Two sided</span>

<span class="co">#=&gt; data:  lmMod$residuals</span>
<span class="co">#=&gt; Standardized Runs Statistic = -23.812, p-value &lt; 2.2e-16</span></code></pre></div>
<p>With a p-value &lt; 2.2e-16, we reject the null hypothesis that it is random. This means there is a definite pattern in the residuals.</p>
<h5>Using Durbin-Watson test.</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Method 3: Durbin-Watson test</span>
lmtest::<span class="kw">dwtest</span>(lmMod)
<span class="co">#=&gt;   Durbin-Watson test</span>

<span class="co">#=&gt; data:  lmMod</span>
<span class="co">#=&gt; DW = 0.0021559, p-value &lt; 2.2e-16</span>
<span class="co">#=&gt; alternative hypothesis: true autocorrelation is greater than 0</span></code></pre></div>
<p>So, <code>dwtest</code> also confirms our finding.</p>
<h4>How to rectify?</h4>
<p>Add lag1 of residual as an X variable to the original model. This can be conveniently done using the <code>slide</code> function in <code>DataCombine</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DataCombine)
econ_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(economics, <span class="dt">resid_mod1=</span>lmMod$residuals)
econ_data_1 &lt;-<span class="st"> </span><span class="kw">slide</span>(econ_data, <span class="dt">Var=</span><span class="st">&quot;resid_mod1&quot;</span>, <span class="dt">NewVar =</span> <span class="st">&quot;lag1&quot;</span>, <span class="dt">slideBy =</span> -<span class="dv">1</span>)
econ_data_2 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(econ_data_1)
lmMod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(pce ~<span class="st"> </span>pop +<span class="st"> </span>lag1, <span class="dt">data=</span>econ_data_2)</code></pre></div>
<p>Lets check if the problem of autocorrelation of error is taken care of using this method.</p>
<p><strong>Check 1</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">acf</span>(lmMod2$residuals)</code></pre></div>
<p><img src='screenshots/acf-plot2.png' width=528 height=305 /></p>
<p>Unlike the <code>acf</code> plot of <code>lmMod</code>, the correlation values drop below the dashed blue line from lag1 itself. So autocorrelation can’t be confirmed.</p>
<p><strong>Check 2</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">runs.test</span>(lmMod2$residuals)  <span class="co"># runs test</span>
<span class="co">#=&gt;   Runs Test - Two sided</span>
<span class="co">#=&gt; </span>
<span class="co">#=&gt; data:  lmMod2$residuals</span>
<span class="co">#=&gt; Standardized Runs Statistic = 0.96176, p-value = 0.3362</span></code></pre></div>
<p>p-value = 0.3362. Can’t reject null hyp that it is random. With a p-value = 0.3362, we cannot reject the null hypothesis. Therefore we can safely assume that residuals are not autocorrelated.</p>
<p><strong>Check 3</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lmtest::<span class="kw">dwtest</span>(lmMod2)
<span class="co">#=&gt;   Durbin-Watson test</span>
<span class="co">#=&gt; </span>
<span class="co">#=&gt; data:  lmMod2</span>
<span class="co">#=&gt; DW = 2.0431, p-value = 0.6672</span>
<span class="co">#=&gt; alternative hypothesis: true autocorrelation is greater than 0</span></code></pre></div>
<p>With a high p value of 0.667, we cannot reject the null hypothesis that true autocorrelation is zero. So the assumption that errors should not be autocorrelated is satisfied by this model.</p>
<p>If, even after adding lag1 as an X variable, does not satidfy the assumption of autocorrelation of errors, you might want to try adding lag2, or be creative in making meaningful derived explanatory variables or interaction terms. This is more like art than an algorithm.</p>
<h2>Assumption 5</h2>
<blockquote>
<h4><em>The X variables and Errors are uncorrelated</em></h4>
</blockquote>
<h4>How to check?</h4>
<p>Do a correlation test on the X variable and the residuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars)
<span class="kw">cor.test</span>(cars$speed, mod.lm$residuals)  <span class="co"># do correlation test </span>
<span class="co">#=&gt;   Pearson&#39;s product-moment correlation</span>
<span class="co">#=&gt; </span>
<span class="co">#=&gt; data:  cars$speed and mod.lm$residuals</span>
<span class="co">#=&gt; t = -8.1225e-17, df = 48, p-value = 1</span>
<span class="co">#=&gt; alternative hypothesis: true correlation is not equal to 0</span>
<span class="co">#=&gt; 95 percent confidence interval:</span>
<span class="co">#=&gt; -0.2783477  0.2783477</span>
<span class="co">#=&gt; sample estimates:</span>
<span class="co">#=&gt;           cor </span>
<span class="co">#=&gt; -1.172376e-17</span></code></pre></div>
<p>p-value is high, so null hypothesis that true correlation is 0 can’t be rejected. So, the assumption holds true for this model.</p>
<h2>Assumption 6</h2>
<h4><em>The number of observations must be greater than number of Xs</em></h4>
<p>This can be directly observed by looking at the data.</p>
<h2>Assumption 7</h2>
<blockquote>
<h4><em>The variablility in X values is positive</em></h4>
</blockquote>
<p>This means the X values in a given sample must not all be the same (or even nearly the same).</p>
<h4>How to check?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var</span>(cars$speed)  
<span class="co">#=&gt; [1] 27.95918</span></code></pre></div>
<p>The variance in the X variable above is much larger than 0. So, this assumption is satisfied.</p>
<h2>Assumption 8</h2>
<blockquote>
<h4><em>The regression model is correctly specified</em></h4>
</blockquote>
<p>This means that if the Y and X variable has an inverse relationship, the model equation should be specified appropriately:</p>
<p><br /><span class="math display">$$Y = \beta1 + \beta2 * \left( 1 \over X \right)$$</span><br /></p>
<h2>Assumption 9</h2>
<blockquote>
<h4><em>No perfect multicollinearity</em></h4>
</blockquote>
<p>There is no perfect linear relationship between explanatory variables.</p>
<h4>How to check?</h4>
<p>Using Variance Inflation factor (VIF). But, What is VIF?</p>
<p>VIF is a metric computed for every <span class="math inline"><em>X</em></span> variable that goes into a linear model. If the VIF of a variable is high, it means the information in that variable is already explained by other <span class="math inline"><em>X</em></span> variables present in the given model, which means, more redundant is that variable. So, lower the VIF (&lt;2) the better. VIF for a <span class="math inline"><em>X</em></span> var is calculated as:</p>
<p><br /><span class="math display">$$VIF = {1 \over \left( 1-R_{sq} \right)}$$</span><br /></p>
<p>where, <span class="math inline"><em>R</em><sub><em>s</em><em>q</em></sub></span> is the <span class="math inline"><em>R</em><sub><em>s</em><em>q</em></sub></span> term for the model with given <span class="math inline"><em>X</em></span> as response against all other <span class="math inline"><em>X</em><em>s</em></span> that went into the model as predictors.</p>
<p>Practically, if two of the <span class="math inline"><em>X</em>′<em>s</em></span> have high correlation, they will likely have high VIFs. Generally, VIF for an <span class="math inline"><em>X</em></span> variable should be less than 4 in order to be accepted as not causing multi-collinearity. The cutoff is kept as low as 2, if you want to be strict about your <span class="math inline"><em>X</em></span> variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>., <span class="dt">data=</span>mtcars)
<span class="kw">vif</span>(mod2)
<span class="co">#   cyl      disp        hp      drat        wt      qsec        vs        am      gear      carb </span>
<span class="co">#   15.373833 21.620241  9.832037  3.374620 15.164887  7.527958  4.965873  4.648487  5.357452  7.908747 </span></code></pre></div>
<h4>How to rectify?</h4>
<p>Two ways:</p>
<ol style="list-style-type: decimal">
<li>Either iteratively remove the <span class="math inline"><em>X</em></span> var with the highest VIF or,</li>
<li>See correlation between all variables and keep only one of all highly correlated pairs.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(corrplot)
<span class="kw">corrplot</span>(<span class="kw">cor</span>(mtcars[, -<span class="dv">1</span>]))
<span class="co">#=&gt; Interpreted from below plot.</span>
<span class="co">#=&gt; Correlated pairs: </span>
<span class="co">#=&gt; - disp, cyl, hp, wt</span>
<span class="co">#=&gt; - gear, am</span>
<span class="co">#=&gt; - hp, carb</span></code></pre></div>
<p><img src='screenshots/corrplot.png' width=528 height=528 /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>gear, <span class="dt">data=</span>mtcars)
<span class="kw">vif</span>(mod)
<span class="co">#=&gt;      cyl     gear </span>
<span class="co">#=&gt; 1.320551 1.320551</span></code></pre></div>
<p>The convention is, the VIF should not go more than 4 for any of the X variables. That means we are not letting the <span class="math inline"><em>R</em><sub><em>S</em><em>q</em></sub></span> of any of the <span class="math inline"><em>X</em><em>s</em></span> (the model that was built with that X as a response variable and the remaining <span class="math inline"><em>X</em><em>s</em></span> are predictors) to go more than 75%. =&gt; 1/(1-0.75) =&gt; 1/0.25 =&gt; 4.</p>
<h2>Assumption 10</h2>
<blockquote>
<h4><em>Normality of Errors</em></h4>
</blockquote>
<p>The residuals should be normally distributed. This also implies the <span class="math inline"><em>Y</em></span> and the <span class="math inline"><em>X</em><em>s</em></span> are also normally distributed. It is an essential assumption if the maximum likelihood method is used to commute the estimates.</p>
<p>This can be visually checked using the <code>qqnorm()</code> plot (top right plot).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
mod &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars)
<span class="kw">plot</span>(mod)</code></pre></div>
<p><img src='screenshots/regression-plot.png' width=528 height=528 /></p>
<p>The <code>qqnorm()</code> plot in top-right evaluates this assumption. If points lie exactly on the line, it is perfectly normal distribution. However, some deviation is to be expected, particularly near the ends (note the upper right), but the deviations should be small, even lesser that they are here.</p>
<h2>Check Assumptions Automatically</h2>
<p>The <code>gvlma()</code> function from <code>gvlma</code> offers a way to check the important assumptions on a given linear model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))  <span class="co"># draw 4 plots in same window</span>
mod &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars)
gvlma::<span class="kw">gvlma</span>(mod)
<span class="co">#=&gt;                     Value  p-value                   Decision</span>
<span class="co">#=&gt; Global Stat        15.801 0.003298 Assumptions NOT satisfied!</span>
<span class="co">#=&gt; Skewness            6.528 0.010621 Assumptions NOT satisfied!</span>
<span class="co">#=&gt; Kurtosis            1.661 0.197449    Assumptions acceptable.</span>
<span class="co">#=&gt; Link Function       2.329 0.126998    Assumptions acceptable.</span>
<span class="co">#=&gt; Heteroscedasticity  5.283 0.021530 Assumptions NOT satisfied!</span>
<span class="kw">plot</span>(mod)</code></pre></div>
<p>Three of the assumptions are not satisfied. This is probably because we have only 50 data points in the data and having even 2 or 3 outliers can impact the quality of the model. So the immediate approach to address this is to remove those outliers and re-build the model. Take a look at the diagnostic plot below to arrive at your own conclusion.</p>
<p><img src='screenshots/regression-plot-big.png' width=528 height=393 /></p>
<p>From the above plot the data points: 23, 35 and 49 are marked as outliers. Lets remove them from the data and re-build the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(dist ~<span class="st"> </span>speed, <span class="dt">data=</span>cars[-<span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">35</span>, <span class="dv">49</span>), ])
gvlma::<span class="kw">gvlma</span>(mod)
<span class="co">#=&gt;                     Value p-value                Decision</span>
<span class="co">#=&gt; Global Stat        7.5910 0.10776 Assumptions acceptable.</span>
<span class="co">#=&gt; Skewness           0.8129 0.36725 Assumptions acceptable.</span>
<span class="co">#=&gt; Kurtosis           0.2210 0.63831 Assumptions acceptable.</span>
<span class="co">#=&gt; Link Function      3.2239 0.07257 Assumptions acceptable.</span>
<span class="co">#=&gt; Heteroscedasticity 3.3332 0.06789 Assumptions acceptable.</span>
<span class="co">#=&gt; plot(mod)</span></code></pre></div>
<p><img src='screenshots/regression-plot-big-no-outliers.png' width=528 height=393 /></p>
<p>Though the changes look minor, it is more closer to conforming with the assumptions. There is one more thing left to be explained. That is, the plot in the bottom right. It is the plot of standardised residuals against the leverage. Leverage is a measure of how much each datapoint influences the regression. The plot also contours values of <a href="https://en.wikipedia.org/wiki/Cook%27s_distance">Cook’s distance</a>, which reflects how much the fitted values would change if a point was deleted.</p>
<p>A point far from the centroid with a large residual can severely distort the regression. For a good regression model, the red smoothed line should stay close to the mid-line and no point should have a large cook’s distance (i.e. should not have too much influence on the model.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">influence.measures</span>(mod)
<span class="co">#=&gt;   dfb.1_ dfb.sped    dffit cov.r   cook.d    hat inf</span>
<span class="co">#=&gt;  0.087848 -0.08003  0.08834 1.184 3.99e-03 0.1187   *</span>
<span class="co">#=&gt;  0.351238 -0.32000  0.35320 1.138 6.25e-02 0.1187   *</span>
<span class="co">#=&gt; -0.145914  0.12652 -0.15010 1.114 1.14e-02 0.0735    </span>
<span class="co">#=&gt;  0.285653 -0.24768  0.29384 1.075 4.31e-02 0.0735    </span>
<span class="co">#=&gt;  0.047920 -0.04053  0.05012 1.113 1.28e-03 0.0615    </span>
<span class="co">#=&gt; -0.136783  0.11208 -0.14670 1.083 1.09e-02 0.0511</span>
<span class="co">#=&gt;  .</span>
<span class="co">#=&gt;  .</span>
<span class="co">#=&gt;  .    </span>
<span class="co">#=&gt;  0.200260 -0.27525 -0.33127 1.051 5.43e-02 0.0687    </span>
<span class="co">#=&gt;  0.024652 -0.03277 -0.03811 1.138 7.42e-04 0.0816   *</span>
<span class="co">#=&gt; -0.358515  0.47655  0.55420 0.979 1.46e-01 0.0816    </span>
<span class="co">#=&gt; -0.377456  0.50173  0.58348 0.964 1.60e-01 0.0816    </span>
<span class="co">#=&gt; -0.195430  0.25314  0.28687 1.118 4.14e-02 0.0961</span></code></pre></div>
